---
title: "Exercise 4"
subtitle: "Fortgeschrittene Statistische Software für NF"
author: "Valentin Haury (12686340)"
date: "`r Sys.Date()`"
output: html_document 
---

## Librarys

```{r, warning = FALSE, message = FALSE}
# in this codeblock the most important libraries are loaded
  library(ggplot2)
  library(dplyr)
  library(readr)
  library(tidyverse)
  library(knitr)
  library(easystats)

  library(osmdata)
  library(tmap)
  library(leaflet)
  library(sf)
```


# Planning a city trip around Europe

## Exercise 1: Discovering Barcelona (4 Points)

### a)

```{r}
#this codeblock extracts the geospatial data in bbmatrix and polygon format
bb_matrix <- getbb("Barcelona", format_out = "matrix")
bb_polygon <- getbb("Barcelona", format_out = "sf_polygon")
bb_multipolygon <- bb_polygon$multipolygon
```
While the bounding box matrix is easier to compute, the polygon format allows for more details and accuracy.

b) Create two different plots of the city outline using the polygon format: one interactive and one non-interactive. Customize the plots so that:
  - The borders are shown in "darkblue"
  - You add a title to each map using tm_layout
  - The interactive map allows zooming and panning
  
```{r}
#creates a non-interactive map of Barcelona
tmap_mode("plot")

tm_shape(bb_multipolygon) +
  tm_borders(col = "darkblue") +
  tm_layout(title = "Non-interactive map of Barcelona")
```

```{r}
#creates an interactive map of Barcelona
tmap_mode("view")

tm_shape(bb_multipolygon) +
  tm_borders(col = "darkblue") +
  tm_layout(title = "Interactive map of Barcelona")
```

c) 
While interactive maps are great for use in an online setting because they allow zooming
and scrolling they use all their abilities in document-formats like pdf or paper.


d) 
	
```{r}
#getting the museum data and displaying it as red dots on the OpenStreetMap
museums <- opq(bbox = bb_matrix) %>%
  add_osm_feature(key = "tourism", value = "museum") %>%
  osmdata_sf()

museum_points <- museums$osm_points

tmap_mode("plot")

tm_shape(museum_points) +
  tm_basemap("OpenStreetMap") +
  tm_symbols(col = "red", size = 0.2, fill = "red") +
  tm_layout(title = "Museums in Barcelona")
```


e) Filter the museums to only those that have a name. Then, use {leaflet} to create an interactive map that displays a popup with each museum’s name when clicked. 

Ensure the map:
	-	Centers over Barcelona.
	-	Uses a light basemap (e.g., CartoDB.Positron).
	
```{r}
# filter for museums with a name
museum_points_named <- museum_points %>%
  filter(!is.na(name) & name != "")

# calculate the middle of the map
coords <- st_coordinates(museum_points_named)

museum_points_named <- museum_points_named %>%
  mutate(lon = coords[,1], lat = coords[,2])

center_lon <- mean(bb_matrix[1, ])
center_lat <- mean(bb_matrix[2, ])

# create the interactive map
leaflet(museum_points_named) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  setView(lng = center_lon, lat = center_lat, zoom = 12) %>%
  addCircleMarkers(
    lng = ~lon, lat = ~lat,
    color = "red",
    popup = ~name
  )
```


## Exercise 2: Finding Accommodation in Berlin (5 Points)

Oops, we spent too much money in Barcelona. On our next stop in Berlin, we'd like to plan more budget-friendly and find a simple accommodation option such as a hostel. For this, we'll be using OpenStreetMaps.

a) Search for the correct tag to identify *affordable accommodation* in OpenStreetMaps. Write down the tag below and add the URL to its OSMWiki page. 

b) Write an {osmdata} query that downloads all hostels in Berlin using a bounding box. How many hostels are there in Berlin?
Explain how you interpret points, polygons, and lines in the query results. If no lines are returned (as is often the case for buildings), explain why this is expected. 

c) Since there are quite a few hostels, we want to limit our search a bit. How many of the hostels have a name? How many also include information on the number of beds? 

> Hint: If you have trouble working with the result, look at the different types of result in there. We're only interested in osm_points here.

d) Use tm_dots() to plot the hostels in Berlin on an *interactive* map 

	-	Color the dots based on the type of internet access provided by each hostel (internet_access). 
	-	Use the hostel’s name as the ID to display when hovering over a dot on the map. 
	-	Choose an appropriate color palette and	add a title to the map indicating that it shows hostels in Berlin by internet access.

e) Your grandma, who lives in Berlin, just called and said she wanted to come visit you at the hostels. Grandma is struggling with walking up stairs. Create a bar chart using {ggplot2} showing wheelchair-accessibility from the named hostels. You can use str() for the variable you saved in the previous exercise to find the proper variable for wheelchair-accessible hostels. Filter the dataset to include only hostels where wheelchair is "yes", "limited", or "no". Then, represent the following:
	-	"yes" for full accessibility,
	-	"limited" for limited accessibility,
	-	"no" for no accessibility.

f) We're almost done! Lastly, select one of the hostels that you find appealing and return only its row in the data. What's the name of the hostel you chose and why did you choose this one?

## Exercise 3: It's coming home (6 Points)

In this exercise you will analyze and visualize some datasets, that contain information on every professional football match played in the UK since 1888. 
You can access the data via this GitHub repository: <https://github.com/jfjelstul/englishfootball>

a) Load the `{matches.csv}` file from the `{data}` folder. Visualize how the number of total goals scored per game has evolved over time. Create a nice and complete plot and interpret what you see in one or two sentences. 

b) Now create an animated version of your plot and include the GIF in your HTML 

c) Load the `{standings.csv}` dataset. We will now analyze how Liverpool FC has performed over the years. Create an animated plot that contains the number of points and the final placement of LFC for every year they have participated in professional football. The exact visualization is up to you.

d) Adjust the velocity of your animations. Also change one of your axes with respect to being fixed or not. 

