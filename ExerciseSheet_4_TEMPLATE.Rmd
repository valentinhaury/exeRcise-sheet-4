---
title: "Exercise 4"
subtitle: "Fortgeschrittene Statistische Software für NF"
author: "Valentin Haury (12686340)"
date: "`r Sys.Date()`"
output: html_document 
---

## Librarys

```{r, warning = FALSE, message = FALSE}
# in this codeblock the most important libraries are loaded
  library(ggplot2)
  library(dplyr)
  library(readr)
  library(tidyverse)
  library(knitr)
  library(easystats)

  library(osmdata)
  library(tmap)
  library(leaflet)
  library(sf)
```


# Planning a city trip around Europe

## Exercise 1: Discovering Barcelona (4 Points)

### a)

```{r}
#this codeblock extracts the geospatial data in bbmatrix and polygon format
bb_matrix <- getbb("Barcelona", format_out = "matrix")
bb_polygon <- getbb("Barcelona", format_out = "sf_polygon")
bb_multipolygon <- bb_polygon$multipolygon
```
While the bounding box matrix is easier to compute, the polygon format allows for more details and accuracy.

### b) Create two different plots of the city outline using the polygon format: one interactive and one non-interactive. Customize the plots so that:
  - The borders are shown in "darkblue"
  - You add a title to each map using tm_layout
  - The interactive map allows zooming and panning
  
```{r}
#creates a non-interactive map of Barcelona
tmap_mode("plot")

tm_shape(bb_multipolygon) +
  tm_borders(col = "darkblue") +
  tm_layout(title = "Non-interactive map of Barcelona")
```

```{r}
#creates an interactive map of Barcelona
tmap_mode("view")

tm_shape(bb_multipolygon) +
  tm_borders(col = "darkblue") +
  tm_layout(title = "Interactive map of Barcelona")
```

### c) 
While interactive maps are great for use in an online setting because they allow zooming
and scrolling they use all their abilities in document-formats like pdf or paper.


### d) 
	
```{r}
#getting the museum data and displaying it as red dots on the OpenStreetMap
museums <- opq(bbox = bb_matrix) %>%
  add_osm_feature(key = "tourism", value = "museum") %>%
  osmdata_sf()

museum_points <- museums$osm_points

tmap_mode("plot")

tm_shape(museum_points) +
  tm_basemap("OpenStreetMap") +
  tm_symbols(col = "red", size = 0.2, fill = "red") +
  tm_layout(title = "Museums in Barcelona")
```


### e) Filter the museums to only those that have a name. Then, use {leaflet} to create an interactive map that displays a popup with each museum’s name when clicked. 

Ensure the map:
	-	Centers over Barcelona.
	-	Uses a light basemap (e.g., CartoDB.Positron).
	
```{r}
# filter for museums with a name
museum_points_named <- museum_points %>%
  filter(!is.na(name) & name != "")

# calculate the middle of the map
coords <- st_coordinates(museum_points_named)

museum_points_named <- museum_points_named %>%
  mutate(lon = coords[,1], lat = coords[,2])

center_lon <- mean(bb_matrix[1, ])
center_lat <- mean(bb_matrix[2, ])

# create the interactive map
leaflet(museum_points_named) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  setView(lng = center_lon, lat = center_lat, zoom = 12) %>%
  addCircleMarkers(
    lng = ~lon, lat = ~lat,
    color = "red",
    popup = ~name
  )
```


## Exercise 2: Finding Accommodation in Berlin (5 Points)

Oops, we spent too much money in Barcelona. On our next stop in Berlin, we'd like to plan more budget-friendly and find a simple accommodation option such as a hostel. For this, we'll be using OpenStreetMaps.

### a)

Tag: tourism=hostel

[OSM-Wiki-tourism=hostel](https://wiki.openstreetmap.org/wiki/Tag:tourism%3Dhostel)

### b)  

```{r}
# get berlin data
bbox_berlin <- getbb("Berlin, Germany")

# get only hostels
hostels_berlin <- opq(bbox = bbox_berlin) %>%
  add_osm_feature(key = "tourism", value = "hostel") %>%
  osmdata_sf()

# count the different variabls and sum
n_hostels_points <- nrow(hostels_berlin$osm_points)
n_hostels_polygons <- nrow(hostels_berlin$osm_polygons)
n_hostels_lines <- nrow(hostels_berlin$osm_lines)

total_hostels <- n_hostels_polygons + n_hostels_points + n_hostels_lines

```

In Berlin are between `r n_hostels_points` and `r total_hostels` hostels. If a hostel is listed as a point only the location is available. If a hostel is listed
as a polygon there is also an additional information about the shape of the hostel on the map available. 
Because i am not sure if a hostel can be listed as a point and a polygon at the same time i put the number of total hostels as a range to cover
all possible combinations.
Lines are used for linear features like borders or rivers and buildings are not linear.

### c) 

```{r}
# sums over the different variables
n_with_name <- sum(!is.na(hostels_berlin$osm_points$name))

n_with_name_and_beds <- sum(!is.na(hostels_berlin$osm_points$name) & !is.na(hostels_berlin$osm_points$beds))
```

There are `r n_with_name` hostels with a name and of those `r n_with_name_and_beds` also have information about the number of beds.

### d) 

	
```{r, warning = FALSE, message = FALSE}
# filter hostel with a name and information about the internet access and create a interactive map
hostel_points_filtered <- hostels_berlin$osm_points %>%
  filter(!is.na(internet_access) & !is.na(name))

tmap_mode("view")

tm_shape(hostel_points_filtered) +
  tm_dots(
    col = "internet_access",
    id = "name",
    palette = "Set2"
  ) +
  tm_layout(
    title = "Hostels in Berlin by Internet Access",
    legend.outside = TRUE
  )

```

### e)

```{r}
# filter hostels with a name, look for wheelchair variable and filter for that variable beeing not empty
named_hostel_points <- hostels_berlin$osm_points %>%
  filter(!is.na(name))

str(named_hostel_points[, 78:79])

wheelchair_description_available <- named_hostel_points %>%
  filter(!is.na(wheelchair))

```

```{r}
# create a bar plot witht the wheelchair variable
ggplot(wheelchair_description_available, aes(x = wheelchair, fill = wheelchair)) +
  geom_bar() +
  scale_fill_manual(
    values = c("yes" = "green", "limited" = "orange", "no" = "red"),
    name = "Wheelchair Access",
    labels = c("yes" = "full accessibility", "limited" = "limited accessibility", "no" = "no accessibility")
  ) +
  labs(
    title = "Wheelchair-Accessibility of Hostels in Berlin",
    x = "Accessibility Level",
    y = "Number of Hostels"
  )
```

### f)

```{r}

heart_of_gold <- named_hostel_points %>%
  filter(name == "Heart of Gold Hostel Berlin")

heart_of_gold[, 1:15]

```

The Heart of gold Hostel has an entrance in the bike and bed column, that means it is certified by the adfc to be a good hostel for cyclists.

## Exercise 3: It's coming home (6 Points)

In this exercise you will analyze and visualize some datasets, that contain information on every professional football match played in the UK since 1888. 
You can access the data via this GitHub repository: <https://github.com/jfjelstul/englishfootball>

a) Load the `{matches.csv}` file from the `{data}` folder. Visualize how the number of total goals scored per game has evolved over time. Create a nice and complete plot and interpret what you see in one or two sentences. 

b) Now create an animated version of your plot and include the GIF in your HTML 

c) Load the `{standings.csv}` dataset. We will now analyze how Liverpool FC has performed over the years. Create an animated plot that contains the number of points and the final placement of LFC for every year they have participated in professional football. The exact visualization is up to you.

d) Adjust the velocity of your animations. Also change one of your axes with respect to being fixed or not. 

